# 即时通讯系统 (Instant-Messaging-System)

这是一个基于Go语言实现的简单即时通讯系统，包含服务端和客户端组件，支持公聊、私聊、用户状态管理等功能。

## 项目特点

- **多用户支持**：支持多个用户同时在线聊天
- **多种聊天模式**：
  - 公聊模式：向所有在线用户广播消息
  - 私聊模式：向指定用户发送私密消息
- **用户管理**：
  - 在线用户查询
  - 用户名修改
  - 用户状态通知（上线/下线）
- **超时管理**：5分钟不活动自动踢出
- **命令行界面**：简洁易用的文本界面

## 运行环境

- Go 1.24.4 或更高版本

## 快速开始

### 1. 启动服务端

```bash
go run main.go server.go user.go
```

服务端默认监听 `127.0.0.1:8888`，启动后控制台输入 `exit` 可关闭服务器。

### 2. 启动客户端

```bash
go run client.go
```

客户端默认连接到 `127.0.0.1:8888`，可以使用参数指定服务器地址：

```bash
go run client.go -ip 192.168.1.100 -port 8888
```

## 使用指南

### 主菜单

客户端启动后显示以下菜单：

```
1.公聊模式
2.私聊模式
3.更新用户名
4.查询当前在线用户
0.退出
```

### 功能说明

1. **公聊模式**：
   - 输入消息后按回车发送给所有在线用户
   - 输入 `exit` 退出公聊模式

2. **私聊模式**：
   - 先查询在线用户列表
   - 输入目标用户名
   - 输入要发送的消息
   - 格式：`@用户名@消息内容`

3. **更新用户名**：
   - 输入新用户名
   - 用户名不能与其他用户重复

4. **查询当前在线用户**：
   - 显示所有在线用户的[地址]用户名

### 超时机制

- 用户5分钟不活动会被自动踢出
- 被踢出前会收到系统提示

## 项目结构

| 文件        | 说明                                                                 |
|-------------|----------------------------------------------------------------------|
| `client.go` | 客户端主程序，处理用户输入、连接服务器和显示消息                     |
| `server.go` | 服务端主程序，管理连接、用户状态和消息路由                           |
| `user.go`   | 用户对象定义，处理用户相关操作（上线/下线/消息处理）                 |
| `main.go`   | 服务端启动入口                                                       |
| `go.mod`    | Go模块定义文件                                                       |

## 技术细节

### 通信协议
- 基于TCP协议的自定义文本协议
- 消息格式：
  - 公聊：普通文本
  - 私聊：`@接收者@消息内容`
  - 改名：`更改用户名@群助手@新用户名`
  - 查询用户：`查询当前在线用户@群助手`

### 并发处理
- 使用goroutine处理并发连接
- 使用通道(channel)进行消息广播
- 读写锁(sync.RWMutex)保护共享资源

### 超时管理
- 使用 `time.Timer` 实现5分钟不活动检测
- 每次收到用户消息会重置计时器

## 注意事项

1. **私聊格式**：
   - 必须严格按照 `@用户名@消息内容` 格式
   - 用户名区分大小写

2. **改名限制**：
   - 不能与其他在线用户重名
   - 改名成功后立即生效

3. **特殊指令**：
   - 服务端控制台输入 `exit` 关闭服务器
   - 客户端输入 `exit` 退出当前聊天模式或整个程序

4. **超时提示**：
   - 用户被踢出前会收到系统提示
   - 超时后连接会自动关闭

## 扩展建议

1. 添加消息持久化存储
2. 实现群组聊天功能
3. 增加消息加密功能
4. 添加文件传输支持
5. 实现用户认证系统